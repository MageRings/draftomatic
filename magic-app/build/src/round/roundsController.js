var Magic;
(function (Magic) {
    var App;
    (function (App) {
        var Round;
        (function (Round) {
            var RoundsController = (function () {
                function RoundsController($scope, $stateParams, $http) {
                    var _this = this;
                    this.tournamentId = $stateParams["id"];
                    this.scope = $scope;
                    this.http = $http;
                    this.http.get("api/tournament/status/" + this.tournamentId).then(function (response) {
                        console.log(response);
                        _this.tournament = response.data.tournamentData;
                        _this.tournament.complete = response.data.complete;
                        _this.tournament.currentRound = response.data.currentRound;
                        _this.tournament.finalStandings = response.data.finalStandings;
                        _this.http.get("api/tournament/standings/" + _this.tournamentId, { round: "1" }).then(function (response) {
                            var numPairs = Math.floor(response.data.length / 2);
                            _this.seatings = new Array(response.data.length);
                            for (var i = 0; i < numPairs; i += 2) {
                                _this.seatings[i] = response.data[i].player.name;
                                _this.seatings[i + 1] = response.data[i + numPairs].player.name;
                                _this.seatings[i + numPairs] = response.data[i + 1].player.name;
                                _this.seatings[i + 1 + numPairs] = response.data[i + 1 + numPairs].player.name;
                            }
                            if (response.data.length % 2 != 0) {
                                //there is a bye
                                _this.seatings[response.data.length - 1] = response.data[response.data.length - 1].player.name;
                            }
                        });
                    });
                }
                RoundsController.prototype.pairNextRound = function () {
                    var _this = this;
                    var latestRound = this.tournament.rounds[this.tournament.currentRound - 1];
                    latestRound.complete = true;
                    this.http.put("api/tournament/results/" + this.tournamentId, latestRound.matches).then(function (response) {
                        _this.tournament.rounds.push(response.data);
                        _this.tournament.currentRound = response.data.number;
                    });
                };
                RoundsController.prototype.undoLastRound = function () {
                    var _this = this;
                    this.http.delete("api/tournament/round/" + this.tournamentId).then(function (response) {
                        _this.tournament.complete = false;
                        var latestRound = _this.tournament.rounds[_this.tournament.currentRound - 1];
                        if (!latestRound.complete) {
                            _this.tournament.rounds.pop();
                        }
                        _this.tournament.rounds.pop();
                        _this.tournament.rounds.push(response.data);
                        _this.tournament.currentRound = _this.tournament.rounds.length;
                    });
                };
                RoundsController.prototype.getFinalStandings = function () {
                    var _this = this;
                    this.tournament.complete = true;
                    var latestRound = this.tournament.rounds[this.tournament.currentRound - 1];
                    latestRound.complete = true;
                    this.http.put("api/tournament/results/" + this.tournamentId, latestRound.matches).then(function () {
                        _this.http.get("api/tournament/standings/" + _this.tournamentId, { round: latestRound.number }).then(function (response) {
                            _this.tournament.finalStandings = response.data;
                        });
                    });
                };
                RoundsController.prototype.downloadTournamentData = function () {
                    window.location.href = "api/tournament/export/" + this.tournamentId;
                };
                RoundsController.$inject = ["$scope", "$stateParams", "$http"];
                return RoundsController;
            })();
            Round.RoundsController = RoundsController;
            App.magic.controller("roundsController", RoundsController);
        })(Round = App.Round || (App.Round = {}));
    })(App = Magic.App || (Magic.App = {}));
})(Magic || (Magic = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdW5kL3JvdW5kc0NvbnRyb2xsZXIudHMiXSwibmFtZXMiOlsiTWFnaWMiLCJNYWdpYy5BcHAiLCJNYWdpYy5BcHAuUm91bmQiLCJNYWdpYy5BcHAuUm91bmQuUm91bmRzQ29udHJvbGxlciIsIk1hZ2ljLkFwcC5Sb3VuZC5Sb3VuZHNDb250cm9sbGVyLmNvbnN0cnVjdG9yIiwiTWFnaWMuQXBwLlJvdW5kLlJvdW5kc0NvbnRyb2xsZXIucGFpck5leHRSb3VuZCIsIk1hZ2ljLkFwcC5Sb3VuZC5Sb3VuZHNDb250cm9sbGVyLnVuZG9MYXN0Um91bmQiLCJNYWdpYy5BcHAuUm91bmQuUm91bmRzQ29udHJvbGxlci5nZXRGaW5hbFN0YW5kaW5ncyIsIk1hZ2ljLkFwcC5Sb3VuZC5Sb3VuZHNDb250cm9sbGVyLmRvd25sb2FkVG91cm5hbWVudERhdGEiXSwibWFwcGluZ3MiOiJBQUFBLElBQU8sS0FBSyxDQTRFWDtBQTVFRCxXQUFPLEtBQUs7SUFBQ0EsSUFBQUEsR0FBR0EsQ0E0RWZBO0lBNUVZQSxXQUFBQSxHQUFHQTtRQUFDQyxJQUFBQSxLQUFLQSxDQTRFckJBO1FBNUVnQkEsV0FBQUEsS0FBS0EsRUFBQ0EsQ0FBQ0E7WUFFcEJDO2dCQVFJQywwQkFBWUEsTUFBaUJBLEVBQUVBLFlBQXVDQSxFQUFFQSxLQUFzQkE7b0JBUmxHQyxpQkF1RUNBO29CQTlET0EsSUFBSUEsQ0FBQ0EsWUFBWUEsR0FBR0EsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7b0JBQ3ZDQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxNQUFNQSxDQUFDQTtvQkFDcEJBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLEtBQUtBLENBQUNBO29CQUNsQkEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBTUEsd0JBQXdCQSxHQUFHQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFDQSxRQUFRQTt3QkFDM0VBLE9BQU9BLENBQUNBLEdBQUdBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO3dCQUN0QkEsS0FBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0E7d0JBQy9DQSxLQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxRQUFRQSxHQUFHQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQTt3QkFDbERBLEtBQUlBLENBQUNBLFVBQVVBLENBQUNBLFlBQVlBLEdBQUdBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBO3dCQUMxREEsS0FBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsY0FBY0EsR0FBR0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0E7d0JBQzlEQSxLQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFNQSwyQkFBMkJBLEdBQUdBLEtBQUlBLENBQUNBLFlBQVlBLEVBQUVBLEVBQUNBLEtBQUtBLEVBQUdBLEdBQUdBLEVBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFVBQUNBLFFBQVFBOzRCQUM3RkEsSUFBSUEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7NEJBQ2xEQSxLQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxLQUFLQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTs0QkFDaERBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLFFBQVFBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBO2dDQUNuQ0EsS0FBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFB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QUFRQSxDQUFDQSxJQUFJQSxDQUFBQTt3QkFDbERBLENBQUNBLENBQUNBLENBQUNBO29CQUNQQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDUEEsQ0FBQ0E7Z0JBRU1KLGlEQUFzQkEsR0FBN0JBO29CQUNJSyxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxHQUFHQSx3QkFBd0JBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBO2dCQUN4RUEsQ0FBQ0E7Z0JBbEVhTCx3QkFBT0EsR0FBR0EsQ0FBQ0EsUUFBUUEsRUFBRUEsY0FBY0EsRUFBRUEsT0FBT0EsQ0FBQ0EsQ0FBQ0E7Z0JBbUVoRUEsdUJBQUNBO1lBQURBLENBdkVBRCxBQXVFQ0MsSUFBQUQ7WUF2RVlBLHNCQUFnQkEsbUJBdUU1QkEsQ0FBQUE7WUFFREEsU0FBS0EsQ0FBQ0EsVUFBVUEsQ0FBQ0Esa0JBQWtCQSxFQUFFQSxnQkFBZ0JBLENBQUNBLENBQUNBO1FBQzNEQSxDQUFDQSxFQTVFZ0JELEtBQUtBLEdBQUxBLFNBQUtBLEtBQUxBLFNBQUtBLFFBNEVyQkE7SUFBREEsQ0FBQ0EsRUE1RVlELEdBQUdBLEdBQUhBLFNBQUdBLEtBQUhBLFNBQUdBLFFBNEVmQTtBQUFEQSxDQUFDQSxFQTVFTSxLQUFLLEtBQUwsS0FBSyxRQTRFWCIsImZpbGUiOiJyb3VuZC9yb3VuZHNDb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlIE1hZ2ljLkFwcC5Sb3VuZCB7XG5cbiAgICBleHBvcnQgY2xhc3MgUm91bmRzQ29udHJvbGxlciB7XG4gICAgICAgIHByaXZhdGUgc2NvcGU6IG5nLklTY29wZTtcbiAgICAgICAgcHVibGljIHRvdXJuYW1lbnQ6IGFueTtcbiAgICAgICAgcHVibGljIHNlYXRpbmdzOiBhbnk7XG4gICAgICAgIHB1YmxpYyBzdGF0aWMgJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcIiRodHRwXCJdO1xuICAgICAgICBwcml2YXRlIHRvdXJuYW1lbnRJZCA6IHN0cmluZztcbiAgICAgICAgcHJpdmF0ZSBodHRwIDogbmcuSUh0dHBTZXJ2aWNlO1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IoJHNjb3BlOiBuZy5JU2NvcGUsICRzdGF0ZVBhcmFtczogbmcudWkuSVN0YXRlUGFyYW1zU2VydmljZSwgJGh0dHA6IG5nLklIdHRwU2VydmljZSkge1xuICAgICAgICAgICAgdGhpcy50b3VybmFtZW50SWQgPSAkc3RhdGVQYXJhbXNbXCJpZFwiXTtcbiAgICAgICAgICAgIHRoaXMuc2NvcGUgPSAkc2NvcGU7XG4gICAgICAgICAgICB0aGlzLmh0dHAgPSAkaHR0cDtcbiAgICAgICAgICAgIHRoaXMuaHR0cC5nZXQ8YW55PihcImFwaS90b3VybmFtZW50L3N0YXR1cy9cIiArIHRoaXMudG91cm5hbWVudElkKS50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRvdXJuYW1lbnQgPSByZXNwb25zZS5kYXRhLnRvdXJuYW1lbnREYXRhO1xuICAgICAgICAgICAgICAgIHRoaXMudG91cm5hbWVudC5jb21wbGV0ZSA9IHJlc3BvbnNlLmRhdGEuY29tcGxldGU7XG4gICAgICAgICAgICAgICAgdGhpcy50b3VybmFtZW50LmN1cnJlbnRSb3VuZCA9IHJlc3BvbnNlLmRhdGEuY3VycmVudFJvdW5kO1xuICAgICAgICAgICAgICAgIHRoaXMudG91cm5hbWVudC5maW5hbFN0YW5kaW5ncyA9IHJlc3BvbnNlLmRhdGEuZmluYWxTdGFuZGluZ3M7XG4gICAgICAgICAgICAgICAgdGhpcy5odHRwLmdldDxhbnk+KFwiYXBpL3RvdXJuYW1lbnQvc3RhbmRpbmdzL1wiICsgdGhpcy50b3VybmFtZW50SWQsIHtyb3VuZCA6IFwiMVwifSkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG51bVBhaXJzID0gTWF0aC5mbG9vcihyZXNwb25zZS5kYXRhLmxlbmd0aC8yKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWF0aW5ncyA9IG5ldyBBcnJheShyZXNwb25zZS5kYXRhLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtUGFpcnM7IGkgKz0gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWF0aW5nc1tpXSA9IHJlc3BvbnNlLmRhdGFbaV0ucGxheWVyLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXRpbmdzW2krMV0gPSByZXNwb25zZS5kYXRhW2kgKyBudW1QYWlyc10ucGxheWVyLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXRpbmdzW2krIG51bVBhaXJzXSA9IHJlc3BvbnNlLmRhdGFbaSArIDFdLnBsYXllci5uYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWF0aW5nc1tpKyAxICsgbnVtUGFpcnNdID0gcmVzcG9uc2UuZGF0YVtpICsgMSArIG51bVBhaXJzXS5wbGF5ZXIubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5sZW5ndGglMiAhPSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3RoZXJlIGlzIGEgYnllXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXRpbmdzW3Jlc3BvbnNlLmRhdGEubGVuZ3RoIC0gMV0gPSByZXNwb25zZS5kYXRhW3Jlc3BvbnNlLmRhdGEubGVuZ3RoLTFdLnBsYXllci5uYW1lO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcHVibGljIHBhaXJOZXh0Um91bmQoKSB7XG4gICAgICAgICAgICB2YXIgbGF0ZXN0Um91bmQgPSB0aGlzLnRvdXJuYW1lbnQucm91bmRzW3RoaXMudG91cm5hbWVudC5jdXJyZW50Um91bmQtMV07XG4gICAgICAgICAgICBsYXRlc3RSb3VuZC5jb21wbGV0ZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmh0dHAucHV0PGFueT4oXCJhcGkvdG91cm5hbWVudC9yZXN1bHRzL1wiICsgdGhpcy50b3VybmFtZW50SWQsIGxhdGVzdFJvdW5kLm1hdGNoZXMpLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy50b3VybmFtZW50LnJvdW5kcy5wdXNoKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICAgIHRoaXMudG91cm5hbWVudC5jdXJyZW50Um91bmQgPSByZXNwb25zZS5kYXRhLm51bWJlcjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBwdWJsaWMgdW5kb0xhc3RSb3VuZCgpIHtcbiAgICAgICAgICAgIHRoaXMuaHR0cC5kZWxldGU8YW55PihcImFwaS90b3VybmFtZW50L3JvdW5kL1wiICsgdGhpcy50b3VybmFtZW50SWQpLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy50b3VybmFtZW50LmNvbXBsZXRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdmFyIGxhdGVzdFJvdW5kID0gdGhpcy50b3VybmFtZW50LnJvdW5kc1t0aGlzLnRvdXJuYW1lbnQuY3VycmVudFJvdW5kLTFdO1xuICAgICAgICAgICAgICAgIGlmICghbGF0ZXN0Um91bmQuY29tcGxldGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b3VybmFtZW50LnJvdW5kcy5wb3AoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy50b3VybmFtZW50LnJvdW5kcy5wb3AoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRvdXJuYW1lbnQucm91bmRzLnB1c2gocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgICAgICAgICAgdGhpcy50b3VybmFtZW50LmN1cnJlbnRSb3VuZCA9IHRoaXMudG91cm5hbWVudC5yb3VuZHMubGVuZ3RoO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHB1YmxpYyBnZXRGaW5hbFN0YW5kaW5ncygpIHtcbiAgICAgICAgICAgIHRoaXMudG91cm5hbWVudC5jb21wbGV0ZSA9IHRydWU7XG4gICAgICAgICAgICB2YXIgbGF0ZXN0Um91bmQgPSB0aGlzLnRvdXJuYW1lbnQucm91bmRzW3RoaXMudG91cm5hbWVudC5jdXJyZW50Um91bmQtMV07XG4gICAgICAgICAgICBsYXRlc3RSb3VuZC5jb21wbGV0ZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmh0dHAucHV0PGFueT4oXCJhcGkvdG91cm5hbWVudC9yZXN1bHRzL1wiICsgdGhpcy50b3VybmFtZW50SWQsIGxhdGVzdFJvdW5kLm1hdGNoZXMpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaHR0cC5nZXQ8YW55PihcImFwaS90b3VybmFtZW50L3N0YW5kaW5ncy9cIiArIHRoaXMudG91cm5hbWVudElkLCB7cm91bmQgOiBsYXRlc3RSb3VuZC5udW1iZXJ9KS50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdXJuYW1lbnQuZmluYWxTdGFuZGluZ3MgPSByZXNwb25zZS5kYXRhXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcHVibGljIGRvd25sb2FkVG91cm5hbWVudERhdGEoKSB7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiYXBpL3RvdXJuYW1lbnQvZXhwb3J0L1wiICsgdGhpcy50b3VybmFtZW50SWQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBtYWdpYy5jb250cm9sbGVyKFwicm91bmRzQ29udHJvbGxlclwiLCBSb3VuZHNDb250cm9sbGVyKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==